function fileType(e){return["m3u8","mp4","mpeg","wmv","webm","avi","rmvb","mov","mkv","f4v","flv"].includes(e)?"video":["mp3","m4a","wav","wma","ape","flac","ogg"].includes(e)?"audio":["doc","docx","wps"].includes(e)?"word":["ppt","pptx","xls","xlsx","txt","yaml","ini","cfg"].includes(e)?"doc":["jpg","jpeg","png","gif","bmp","tiff","wmf","tif"].includes(e)?"image":["zip","rar","7z","tar","gz","gz2"].includes(e)?"archive":["url","pdf","exe","md"].includes(e)?e:"other"}function byte(e){if(void 0===e||null===e||isNaN(e))return"-";for(var s=0;e>=1024;)e/=1024,s++;return Math.floor(100*e)/100+" "+["B","KB","MB","GB","TB","PB","EB"][s]}function upload(e,s){var t=new XMLHttpRequest,a={type:"upload",name:e.name,size:e.size,path:s.path};t.open("POST",""),t.overrideMimeType("application/octet-stream"),t.setRequestHeader("x-request",encodeURIComponent(JSON.stringify(a))),t.timeout=0,t.upload.addEventListener("progress",function(e){s.onProgress&&s.onProgress(e)}),t.ontimeout=function(){console.error("The request timed out.")},t.onreadystatechange=function(e){if(4===t.readyState)if(200===t.status){var a;a=t.getResponseHeader("content-type").indexOf("application/json")>=0?JSON.parse(t.responseText):t.responseText,"function"==typeof s.onSuccess&&s.onSuccess(a)}else{console.log(t.status);var i="上传失败。"+statusCode[t.status]||"";alert(i)}},t.send(e)}function uploadTask(e,s,t,a){var i=0,o=s+"_"+i;!function n(){upload(e[i],{path:t?e[i].relativePath||e[i].webkitRelativePath:e[i].name,onStart:function(e){},onProgress:function(a){if(t){var n=Math.ceil(a.loaded/a.total*100)+"%";$("#"+s).find(".upload-progress").css({width:n}),$("#"+s).find(".tip").html("(上传中"+(i+1)+"/"+e.length+")")}else{var l=Math.ceil(a.loaded/a.total*100)+"%";$("#"+o).find(".upload-progress").css({width:l}),$("#"+o).find(".tip").html("(上传中"+l+")")}},onSuccess:function(l){l&&0!=l.status?alert(l.result):(t||($("#"+o).find(".upload-progress").remove(),$("#"+o).find(".tip").remove(),$("#"+o).removeAttr("id").attr("href",(location.pathname+"/"+e[i].name).replace(/\/+/g,"/"))),i++,i<e.length?(o=s+"_"+i,n()):t&&($("#"+s).find(".upload-progress").remove(),$("#"+s).find(".tip").remove(),$("#"+s).removeAttr("id").attr("href",(location.pathname+"/"+a).replace(/\/+/g,"/"))))}})}()}var statusCode={413:"请求实体太大",414:"请求URI太长",415:"不支持的媒体类型"};$(function(){$('input[type="file"]').on("change",function(){var e,s=$(this),t=void 0!==s.attr("webkitdirectory")||void 0!==s.attr("directory"),a=s[0].files,i="j_"+Date.now();if(t)e=(a[0].relativePath||a[0].webkitRelativePath).split("/")[0],$(".list").prepend('<li><a class="clearfix upload" target="" id="'+i+'"><div class="upload-progress"></div><div class="row"><span class="file-name col-md-7 col-sm-6 col-xs-8"><svg aria-hidden="true" focusable="false"><use xlink:href="#icon-folder"></use></svg><span class="tip">(等待中)</span>'+e+'</span><span class="file-size col-md-2 col-sm-2 col-xs-4 text-right">-</span><span class="file-modified col-md-3 col-sm-4 hidden-xs text-right">-</span></div></a></li>');else for(var o=0;o<a.length;o++){var n=a[o];$(".list").prepend('<li><a class="clearfix upload" target="" id="'+i+"_"+o+'"><div class="upload-progress"></div><div class="row"><span class="file-name col-md-7 col-sm-6 col-xs-8"><svg aria-hidden="true" focusable="false"><use xlink:href="#icon-'+fileType(n.name.split(".").pop())+'"></use></svg><span class="tip">(等待中)</span>'+n.name+'</span><span class="file-size col-md-2 col-sm-2 col-xs-4 text-right">'+byte(n.size)+'</span><span class="file-modified col-md-3 col-sm-4 hidden-xs text-right">-</span></div></a></li>')}uploadTask(a,i,t,e)})});
